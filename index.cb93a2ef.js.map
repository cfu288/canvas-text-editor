{"mappings":"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","sources":["src/initializers/create-canvas.ts","src/handlers/handle-click.ts","src/models/gap-buffer.ts","src/models/text-row.ts","src/services/file-registry.ts","src/models/editor-highlight.ts","src/renderers/update-row-syntax-highlighing.ts","src/handlers/handle-key.ts","src/configuration/colors.ts","src/renderers/render-screen.ts","src/app.ts","src/models/font-context.ts","src/models/text-content.ts","src/models/cursor.ts","src/models/scroll.ts","src/handlers/handle-scroll.ts"],"sourcesContent":["export function createCanvas() {\n  let ratio = window.devicePixelRatio;\n  let cv = document.getElementById(\"myCanvas\") as HTMLCanvasElement;\n  let div = document.getElementById(\"canvasContainer\");\n  cv.width = div.clientWidth;\n  cv.height = div.clientHeight;\n  // get current size of the canvas\n  let rect = div.getBoundingClientRect();\n  // increase the actual size of our canvas\n  cv.width = rect.width * ratio;\n  cv.height = rect.height * ratio;\n  // ensure all drawing operations are scaled\n  cv.getContext(\"2d\").scale(ratio, ratio);\n  // scale everything down using CSS\n  cv.style.width = rect.width + \"px\";\n  cv.style.height = rect.height + \"px\";\n\n  return { canvas: cv, context: cv.getContext(\"2d\") };\n}\n","import {\n  textContent,\n  cursor,\n  canvas,\n  context,\n  scroller,\n  requestRender,\n} from \"../app\";\nimport { FontContext } from \"../models/font-context\";\n\nexport function getCharPositionFromCanvasPosition(\n  fontContext: FontContext,\n  clientX,\n  clientY\n): [x: number, y: number] {\n  const rect = canvas.getBoundingClientRect();\n  const x = Math.round((scroller.X + clientX - rect.left) / fontContext.width);\n  const y =\n    Math.round(\n      (Math.abs(scroller.Y) + clientY - rect.top) / fontContext.height\n    ) - 1;\n  return [x, y];\n}\n\nexport function handleClick(event: MouseEvent, fontContext: FontContext) {\n  const [x, y]: [number, number] = getCharPositionFromCanvasPosition(\n    fontContext,\n    event.clientX,\n    event.clientY\n  );\n  if (textContent.charAt(x, y)) {\n    cursor.setPosition([x, y]);\n  } else if (textContent.rowAt(y)) {\n    cursor.setPosition([textContent.rowAt(y).length, y]);\n  }\n  requestRender();\n}\n","// inspired by https://github.com/jaz303/gapbuffer\nexport class GapBuffer<T> {\n  private data: (T | undefined)[] = [];\n  private gapSize: number = 32;\n  private gapStart: number = 0;\n  private gapEnd: number = 32;\n\n  constructor(data: (T | undefined)[], gapSize = 32) {\n    const buff: (T | undefined)[] =\n      gapSize - data.length >= 0 ? Array(gapSize - data.length) : [];\n    this.data = data.concat(buff);\n    this.gapSize = gapSize;\n    this.gapEnd = gapSize > data.length ? gapSize : data.length; // points to first valid char of second buffer, if exists. otherwise, points off of array\n    this.gapStart = data.length || 0; // points at first invalid char after first buffer\n  }\n\n  get length() {\n    return this.data.length - (this.gapEnd - this.gapStart);\n  }\n\n  concat(g: GapBuffer<T>) {\n    for (const item of g) {\n      this.push(item);\n    }\n  }\n\n  delete(ix: number) {\n    this.moveGap(ix + 1);\n    this.gapStart -= 1;\n    if (this.gapStart < 0) {\n      this.gapStart = 0;\n    }\n  }\n\n  insert(ix: number, value: T) {\n    if (this.gapStart === this.gapEnd) {\n      this.data.splice(ix, 0, ...new Array(this.gapSize));\n      this.gapStart = ix;\n      this.gapEnd = ix + this.gapSize;\n    } else {\n      this.moveGap(ix);\n    }\n    this.data[this.gapStart++] = value;\n  }\n\n  get(ix: number) {\n    if (ix >= this.gapStart) {\n      return this.data[ix + (this.gapEnd - this.gapStart)];\n    }\n    return this.data[ix];\n  }\n\n  slice(ix: number, ix2: number) {\n    if (ix >= this.gapStart && ix2 >= this.gapStart) {\n      return this.data.slice(\n        ix + (this.gapEnd - this.gapStart),\n        ix2 + (this.gapEnd - this.gapStart)\n      );\n    } else if (ix < this.gapStart && ix2 >= this.gapStart) {\n      return this.data\n        .slice(ix, this.gapStart)\n        .concat(\n          this.data.slice(this.gapEnd, ix2 + (this.gapEnd - this.gapStart))\n        );\n    } else {\n      return this.data.slice(ix, ix2);\n    }\n  }\n\n  push(value: T) {\n    this.insert(this.length, value);\n  }\n\n  pop() {\n    this.moveGap(this.length);\n    this.gapStart -= 1;\n    if (this.gapStart < 0) {\n      this.gapStart = 0;\n    }\n  }\n\n  /**\n   * @param ix index to move gap to\n   */\n  private moveGap(ix: number) {\n    if (ix < this.gapStart) {\n      // ix is less than current gap start\n      // need to shift elemnts to the right of the ix further right\n\n      // ex insert x into ix 1\n      // how far to shift - ix 1, need to shift 2,32 over\n      // [1,2,3,_,_,4,5]\n      // [  ^   *   *  ]\n      // delta = 32 - 1 = 2\n      let delta = this.gapStart - ix;\n\n      for (let i = delta - 1; i >= 0; i--) {\n        // gapEnd = 5\n        // i = 2 - 1 = 1\n        // this.data[4] = this.data[2]\n        // [1,2,32,_,32,4,5]\n        // i = 1 - 1 = 0\n        // this.data[32] = this.data[1]\n        // [1,2,32,2,32,4,5]\n        this.data[this.gapEnd - delta + i] = this.data[ix + i];\n      }\n      // [1,2,32,2,32,4,5]\n      // [  ^   *   *  ]\n      this.gapStart -= delta;\n      this.gapEnd -= delta;\n      // [1,2,32,2,32,4,5]\n      // [  *   *      ]\n    } else {\n      // Same logic as above but opposite\n      let delta = ix - this.gapStart;\n      for (let i = 0; i < delta; ++i) {\n        this.data[this.gapStart + i] = this.data[this.gapEnd + i];\n      }\n      this.gapStart += delta;\n      this.gapEnd += delta;\n    }\n  }\n\n  get _arr() {\n    return this.data\n      .slice(0, this.gapStart)\n      .concat(this.data.slice(this.gapEnd));\n  }\n\n  /**\n   * Allow for GapBuffer to be iterable like an array\n   */\n  *[Symbol.iterator]() {\n    let ix = 0;\n    while (ix < this.data.length) {\n      if (ix < this.gapStart || ix >= this.gapEnd) {\n        yield this.data[ix];\n        ix += 1;\n      } else {\n        ix += 1;\n      }\n    }\n  }\n\n  *entries(): Generator<[number, T], void, unknown> {\n    let publicIndex = 0;\n    let ix = 0;\n    while (ix < this.data.length) {\n      if (ix < this.gapStart || ix >= this.gapEnd) {\n        yield [publicIndex, this.data[ix]];\n        ix += 1;\n        publicIndex += 1;\n      } else {\n        ix += 1;\n      }\n    }\n  }\n}\n","import { GapBuffer } from \"./gap-buffer\";\n\nexport class TextRow<T> {\n  private _text: GapBuffer<T>;\n\n  constructor(array?: T[]) {\n    this._text = new GapBuffer<T>(array || []);\n  }\n\n  clone() {\n    return new TextRow([...this._text]);\n  }\n\n  get(ix: number) {\n    return this._text.get(ix);\n  }\n\n  get length(): number {\n    return this._text.length;\n  }\n\n  charAtIndex(i: number) {\n    return this._text.get(i);\n  }\n\n  slice(ix: number, ix2: number) {\n    return this._text.slice(ix, ix2);\n  }\n\n  entries(): Generator<[number, T], void, unknown> {\n    return this._text.entries();\n  }\n\n  concat(row: TextRow<T>): TextRow<T> {\n    //TODO: make more efficient with .pushArray or something\n    for (const item of row) {\n      this._text.push(item);\n    }\n    return this;\n  }\n\n  insertValueAt(index: number, value: T): void {\n    this._text.insert(index, value);\n  }\n\n  push(value: T): void {\n    this._text.push(value);\n  }\n\n  pop(): void {\n    this._text.pop();\n  }\n\n  deleteValueAt(index: number): void {\n    this._text.delete(index);\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this._text) {\n      yield item;\n    }\n  }\n}\n","// import { fs, dialog, BaseDirectory } from \"@tauri-apps/api\";\n\nimport { TextContent } from \"../models/text-content\";\n\nexport namespace FileRegistry {\n  export function getFileContents(file: File): Promise<string> {\n    return file.text();\n  }\n\n  export async function saveFileContents(name: string, tc: TextContent) {\n    // create a new handle\n    const newHandle = await window.showSaveFilePicker({ suggestedName: name });\n\n    // create a FileSystemWritableFileStream to write to\n    const writableStream = await newHandle.createWritable();\n\n    // write our file\n    await writableStream.write(tc.toArrayBuffer());\n\n    // close the file and write the contents to disk.\n    return await writableStream.close();\n  }\n\n  /**\n   * Opens file select prompt and returns the selected file object\n   * @returns File object\n   */\n  export async function promptFileSelect(): Promise<File> {\n    const fileHandlerList = await window.showOpenFilePicker({\n      multiple: false,\n    });\n    const file = await fileHandlerList[0].getFile();\n    return file;\n  }\n}\n","export enum EditorHighlight {\n  HL_NORMAL = 0,\n  HL_NUMBER = 1,\n  HL_STRING = 2,\n  HL_COMMENT = 3,\n  HL_KEYWORD1 = 4,\n  HL_KEYWORD2 = 5,\n}\n","import { EditorHighlight } from \"../models/editor-highlight\";\nimport { TextRow } from \"../models/text-row\";\n\nexport const KEYWORDS1 = new Set([\"export\", \"import\", \"new\"]);\n\nexport const KEYWORDS1SET = new Set(KEYWORDS1);\n\nexport const KEYWORDS = [\n  \"await\",\n  \"break\",\n  \"case\",\n  \"class\",\n  \"const\",\n  \"continue\",\n  \"debugger\",\n  \"default\",\n  \"delete\",\n  \"do\",\n  \"else\",\n  \"enum\",\n  \"export\",\n  \"extends\",\n  \"false\",\n  \"finally\",\n  \"for\",\n  \"function\",\n  \"if\",\n  \"implements\",\n  \"import\",\n  \"in\",\n  \"interface\",\n  \"let\",\n  \"new\",\n  \"null\",\n  \"package\",\n  \"private\",\n  \"protected\",\n  \"public\",\n  \"return\",\n  \"static\",\n  \"super\",\n  \"switch\",\n  \"this\",\n  \"throw\",\n  \"try\",\n  \"var\",\n].concat([...KEYWORDS1]);\n\nfunction isComment(r: TextRow<string>) {\n  return r.get(0) === \"/\" && r.get(1) === \"/\";\n}\n\nfunction isDigit(s: string) {\n  return !isNaN(Number(s));\n}\n\nfunction isSeparator(s: string) {\n  return isWhitespace(s) || s === \"\\0\" || !!s.match(\"/^[,.()+-/*=~%<>;]/\");\n}\n\nfunction isWhitespace(s: string) {\n  return s?.trim().length === 0 || s === undefined;\n}\n\n// Row based syntax highlighting\nexport function updateRowSyntaxHighlighting(row: TextRow<string>) {\n  const HLArr = Array(row.length).fill(EditorHighlight.HL_NORMAL);\n\n  // store if prev char was a separator char\n  let prev_sep = true;\n  // store whether currently in a string, and which character was used to start the string\n  let in_string: string | undefined = undefined;\n\n  let i = 0;\n  while (i < row.length) {\n    const ch = row.get(i);\n\n    // handle string highlighting\n    if (in_string !== undefined) {\n      HLArr.splice(i, 1, EditorHighlight.HL_STRING);\n      if (ch === \"\\\\\" && i + 1 < row.length) {\n        HLArr.splice(i, 1, EditorHighlight.HL_STRING);\n        i++;\n      }\n      if (ch === in_string) {\n        in_string = undefined;\n      }\n      prev_sep = true;\n    } else if (ch === '\"' || ch === \"'\") {\n      in_string = ch;\n      HLArr.splice(i, 1, EditorHighlight.HL_STRING);\n    }\n\n    // handle number highlighting\n    if (\n      (isDigit(ch) &&\n        (prev_sep || HLArr[i - 1] === EditorHighlight.HL_NUMBER)) ||\n      (ch == \".\" && HLArr[i - 1] == EditorHighlight.HL_NUMBER)\n    ) {\n      HLArr.splice(i, 1, EditorHighlight.HL_NUMBER);\n    }\n\n    // handle comments\n    if (isComment(row)) {\n      HLArr.length = row.length;\n      HLArr.fill(EditorHighlight.HL_COMMENT);\n      i = row.length;\n    }\n\n    const old_prev_sep = prev_sep;\n    prev_sep = isSeparator(ch);\n\n    // keywords\n    if (old_prev_sep) {\n      // if the prev char was a seperator, check if next n chars in row is a keyword\n      for (const kw of KEYWORDS) {\n        // For now, just loop through keywords (inefficent)\n        // using length klen of keyword\n        const klen = kw.length;\n        // get the next klen chars of the current row to see if it is a keyword\n        const cw = row.slice(i, i + klen).join(\"\");\n        if (cw === kw && row.get(i + klen) && isSeparator(row[i + klen])) {\n          const secondary = KEYWORDS1SET.has(cw);\n          // It is a keyword, mark it in the HL array\n          for (let j = 0; j < klen; j++) {\n            if (secondary) {\n              HLArr.splice(i + j, 1, EditorHighlight.HL_KEYWORD2);\n            } else {\n              HLArr.splice(i + j, 1, EditorHighlight.HL_KEYWORD1);\n            }\n          }\n          // move index past the current key word to skip reprocessing\n          i += klen;\n          prev_sep = true;\n          break;\n        }\n      }\n    }\n\n    i++;\n  }\n  return HLArr;\n}\n","import {\n  textContent,\n  cursor,\n  canvas,\n  context,\n  scroller,\n  requestRender,\n} from \"../app\";\nimport { TextRow } from \"../models/text-row\";\nimport { FileRegistry } from \"../services/file-registry\";\nimport { updateRowSyntaxHighlighting } from \"../renderers/update-row-syntax-highlighing\";\n\nconst OPEN_BRACKETS = new Set([\"[\", \"{\", \"(\", '\"', \"'\"]);\nconst BRACKETS_PAIR = {\n  \"{\": \"}\",\n  \"[\": \"]\",\n  \"(\": \")\",\n  '\"': '\"',\n  \"'\": \"'\",\n};\n\nexport function handleKey(e: KeyboardEvent) {\n  e.preventDefault();\n  // Two meta keys\n  if (e.metaKey && e.shiftKey && [\"ArrowUp\", \"ArrowDown\"].includes(e.code)) {\n    switch (e.code) {\n      case \"ArrowDown\": {\n        scroller.scrollDown();\n        requestRender();\n        break;\n      }\n      case \"ArrowUp\": {\n        scroller.scrollUp();\n        requestRender();\n        break;\n      }\n      default:\n        break;\n    }\n  }\n  // Single meta key\n  if (e.metaKey || e.ctrlKey) {\n    switch (e.code) {\n      case \"KeyO\": {\n        FileRegistry.promptFileSelect().then((file) =>\n          FileRegistry.getFileContents(file).then((data) => {\n            textContent.readFromFile(file.name, data);\n            requestRender();\n          })\n        );\n        break;\n      }\n      case \"KeyS\": {\n        FileRegistry.saveFileContents(textContent.name, textContent).then(\n          () => {\n            alert(`${textContent.name} saved`);\n          }\n        );\n        break;\n      }\n      case \"KeyX\": {\n        textContent.clearBuffer();\n        textContent.addRowToBuffer(textContent.rowAt(cursor.Y));\n        if (textContent.length > 1) {\n          textContent.removeRowAt(cursor.Y);\n        } else {\n          textContent.removeRowAt(cursor.Y);\n          textContent.insertNewRowAt(cursor.Y, new TextRow());\n        }\n        // Arrow up logic\n        const charAbove = textContent.charAt(cursor.X, cursor.Y - 1);\n        const rowAbove = textContent.rowAt(cursor.Y - 1);\n        if (charAbove) {\n          cursor.moveUp();\n        } else if (rowAbove) {\n          cursor.setPosition([rowAbove.length, cursor.Y - 1]);\n        }\n        break;\n      }\n      case \"KeyC\": {\n        textContent.clearBuffer();\n        textContent.addRowToBuffer(textContent.rowAt(cursor.Y));\n        break;\n      }\n      case \"KeyV\": {\n        textContent.insertNewRowsAt(cursor.Y, textContent.buffer);\n        // end of line\n        cursor.setPosition([textContent.rowAt(cursor.Y).length, cursor.Y]);\n        break;\n      }\n      default:\n        break;\n    }\n  } else {\n    // Default key press input\n    let currentRow = textContent.rowAt(cursor.Y);\n    switch (e.code) {\n      case \"Escape\": {\n        break;\n      }\n      case \"MetaRight\": {\n        break;\n      }\n      case \"MetaLeft\": {\n        break;\n      }\n      case \"ShiftLeft\": {\n        break;\n      }\n      case \"ShiftRight\": {\n        break;\n      }\n      case \"ArrowLeft\": {\n        cursor.moveLeft();\n        break;\n      }\n      case \"ArrowRight\": {\n        cursor.moveRight();\n        break;\n      }\n      case \"ArrowUp\": {\n        cursor.moveUp();\n        break;\n      }\n      case \"ArrowDown\": {\n        cursor.moveDown();\n        break;\n      }\n      case \"Enter\": {\n        // end of line, just move to new line\n        if (cursor.X === textContent.rowAt(cursor.Y).length) {\n          textContent.insertNewRowAt(cursor.Y + 1);\n          cursor.setPosition([0, cursor.Y + 1]);\n        }\n        // middle of line, split line into two\n        else {\n          const rowToSpit = textContent.rowAt(cursor.Y),\n            firstLine = rowToSpit.slice(0, cursor.X),\n            secondLine = rowToSpit.slice(cursor.X, rowToSpit.length);\n          textContent.replaceRowAt(cursor.Y, new TextRow<string>(firstLine));\n          textContent.insertNewRowAt(cursor.Y + 1);\n          textContent.replaceRowAt(\n            cursor.Y + 1,\n            new TextRow<string>(secondLine)\n          );\n          cursor.setPosition([0, cursor.Y + 1]);\n        }\n        break;\n      }\n      case \"Backspace\": {\n        if (cursor.X > 0) {\n          // delete item behind cursor\n          currentRow.deleteValueAt(cursor.X - 1);\n          cursor.moveLeft();\n        } else {\n          // if prev line exist,\n          if (textContent.rowAt(cursor.Y - 1)) {\n            // handle merge of prev line and current line\n            const orgLen = textContent.rowAt(cursor.Y - 1).length;\n            const newRow = textContent\n              .rowAt(cursor.Y - 1)\n              .concat(textContent.rowAt(cursor.Y));\n            textContent.replaceRowAt(cursor.Y - 1, newRow);\n            textContent.removeRowAt(cursor.Y);\n            cursor.setPosition([orgLen, cursor.Y - 1]);\n          }\n          // there is no prev line, we are already at the first row\n          // leave cursor where it is\n        }\n        break;\n      }\n      case \"Tab\": {\n        currentRow.push(\" \");\n        currentRow.push(\" \");\n        currentRow.push(\" \");\n        currentRow.push(\" \");\n        cursor.moveRight(4);\n        break;\n      }\n      default:\n        if (OPEN_BRACKETS.has(e.key)) {\n          currentRow.insertValueAt(cursor.X, e.key);\n          cursor.moveRight();\n          currentRow.insertValueAt(cursor.X, BRACKETS_PAIR[e.key]);\n        } else {\n          currentRow.insertValueAt(cursor.X, e.key);\n          cursor.moveRight();\n        }\n        break;\n    }\n  }\n\n  textContent.textHL[cursor.Y] = updateRowSyntaxHighlighting(\n    textContent.rowAt(cursor.Y)\n  );\n  requestRender();\n}\n","export const colors = {\n  background: \"#282a36\",\n  keyword: \"#ff79c6\",\n  title: \"#50fa7b\",\n  text: \"#f8f8f2\",\n  link: \"#8be9fd\",\n  string: \"#f1fa8c\",\n  cursor: \"#8be9fd\",\n  comment: \"#6272a4\",\n  number: \"#bd93f9\",\n};\n","import { colors } from \"../configuration/colors\";\nimport { EditorHighlight } from \"../models/editor-highlight\";\nimport { Cursor } from \"../models/cursor\";\nimport { TextContent } from \"../models/text-content\";\nimport { Scroll } from \"../models/scroll\";\nimport { FontContext } from \"../models/font-context\";\n\nfunction renderText(\n  canvas: HTMLCanvasElement,\n  context: CanvasRenderingContext2D,\n  charXY: FontContext,\n  textContent: TextContent,\n  scroller: Scroll\n) {\n  // Store the current transformation matrix\n  context.save();\n  // Use the identity matrix while clearing the canvas\n  context.setTransform(1, 0, 0, 1, 0, 0);\n  context.clearRect(0, 0, canvas.width, canvas.height);\n  // Restore the transform\n  context.restore();\n\n  context.fillStyle = colors.background;\n  context.fillRect(0, Math.abs(scroller.Y), canvas.width, canvas.height);\n\n  for (const [indexY, row] of textContent.entries()) {\n    context.fillStyle = colors.text;\n    for (const [indexX, char] of row.entries()) {\n      context.save();\n      switch (textContent.textHL[indexY][indexX]) {\n        case EditorHighlight.HL_NUMBER:\n          context.fillStyle = colors.number;\n          break;\n        case EditorHighlight.HL_STRING:\n          context.fillStyle = colors.string;\n          break;\n        case EditorHighlight.HL_COMMENT:\n          context.fillStyle = colors.comment;\n          break;\n        case EditorHighlight.HL_KEYWORD1:\n          context.fillStyle = colors.keyword;\n          break;\n        case EditorHighlight.HL_KEYWORD2:\n          context.fillStyle = colors.link;\n          break;\n        default:\n          context.fillStyle = colors.text;\n          break;\n      }\n      context.fillText(\n        char,\n        charXY.width * indexX,\n        charXY.height * (indexY + 1)\n      );\n      context.restore();\n    }\n  }\n}\n\nfunction renderCursor(\n  canvas: HTMLCanvasElement,\n  context: CanvasRenderingContext2D,\n  charXY: FontContext,\n  cursor: Cursor\n) {\n  context.save();\n  context.beginPath();\n  context.moveTo(cursor.X * charXY.width + 2, cursor.Y * charXY.height + 1);\n  context.lineTo(\n    cursor.X * charXY.width + 2,\n    cursor.Y * charXY.height + charXY.height + 4\n  );\n  context.lineWidth = 2;\n  context.strokeStyle = colors.cursor;\n  context.stroke();\n  context.restore();\n}\n\nexport default function renderScreen(\n  canvas: HTMLCanvasElement,\n  context: CanvasRenderingContext2D,\n  charXY: FontContext,\n  cursor: Cursor,\n  textContent: TextContent,\n  scroller: Scroll\n) {\n  renderText(canvas, context, charXY, textContent, scroller);\n  renderCursor(canvas, context, charXY, cursor);\n}\n","import { createCanvas } from \"./initializers/create-canvas\";\nimport { Cursor } from \"./models/cursor\";\nimport { Scroll } from \"./models/scroll\";\nimport { handleKey, handleClick } from \"./handlers\";\nimport { FontContext } from \"./models/font-context\";\nimport renderScreen from \"./renderers/render-screen\";\nimport { TextContent } from \"./models/text-content\";\nimport { FileRegistry } from \"./services/file-registry\";\nimport { handleScroll } from \"./handlers/handle-scroll\";\n\nexport const { canvas, context } = createCanvas();\nexport const fontContext = new FontContext(context, \"Courier New\", 16, 4);\nexport const textContent = new TextContent(fontContext);\nexport const cursor = new Cursor(textContent);\nexport const scroller = new Scroll(canvas, context, textContent);\n\nexport function requestRender() {\n  window.requestAnimationFrame(() =>\n    renderScreen(canvas, context, fontContext, cursor, textContent, scroller)\n  );\n}\n\ndocument.addEventListener(\"keydown\", handleKey);\ncanvas.addEventListener(\"mousedown\", (e) => handleClick(e, fontContext));\nwindow.addEventListener(\"wheel\", handleScroll);\nwindow.addEventListener(\"resize\", () => {\n  createCanvas();\n  fontContext.setFontStyle();\n  requestRender();\n});\ndocument.getElementById(\"openFileButton\").addEventListener(\"click\", () => {\n  FileRegistry.promptFileSelect().then((file) =>\n    FileRegistry.getFileContents(file).then((data) => {\n      textContent.readFromFile(file.name, data);\n      requestRender();\n    })\n  );\n});\ndocument.getElementById(\"saveFileButton\").addEventListener(\"click\", () => {\n  FileRegistry.saveFileContents(textContent.name, textContent).then(() => {\n    alert(`${textContent.name} saved`);\n  });\n});\n\nrequestRender();\n","export class FontContext {\n  height: number;\n  width: number;\n  fontSize: number;\n  linePadding: number;\n  font: string = \"Courier New\";\n  context: CanvasRenderingContext2D;\n\n  constructor(\n    context: CanvasRenderingContext2D,\n    font: string,\n    fontSize: number,\n    linePadding: number\n  ) {\n    this.font = font || \"Courier New\";\n    this.fontSize = fontSize;\n    context.font = `${this.fontSize}px ${this.font}`;\n    this.width = context.measureText([\"a\"].join(\"\")).width;\n    this.linePadding = linePadding;\n    this.height = fontSize + linePadding;\n    this.context = context;\n  }\n\n  get fontStyle() {\n    return `${this.fontSize}px ${this.font}`;\n  }\n\n  setFontStyle() {\n    this.context.font = `${this.fontSize}px ${this.font}`;\n  }\n}\n","import { EditorHighlight } from \"./editor-highlight\";\nimport { TextRow } from \"./text-row\";\nimport { updateRowSyntaxHighlighting } from \"../renderers/update-row-syntax-highlighing\";\nimport { FontContext } from \"./font-context\";\n\nexport class TextContent {\n  private _text: TextRow<string>[] = [new TextRow()];\n  private _text_hl: EditorHighlight[][] = [[]];\n  private _buffer: TextRow<string>[] = [];\n  private _fileName: string = \"untitled.txt\";\n  private _fontContext: FontContext;\n\n  constructor(fontContext: FontContext) {\n    this._fontContext = fontContext;\n  }\n\n  get contentHeight() {\n    return this._text.length * this._fontContext.height;\n  }\n\n  readFromFile(name: string, s: string) {\n    this._fileName = name || \"untitled.txt\";\n    const rows = s.split(\"\\n\");\n    const rowOfRows = [];\n    const rowOfRowsHL = [];\n    for (const rowIn of rows) {\n      const r = new TextRow(rowIn.split(\"\"));\n      rowOfRows.push(r);\n      rowOfRowsHL.push(updateRowSyntaxHighlighting(r));\n    }\n    this._text = rowOfRows;\n    this._text_hl = rowOfRowsHL;\n  }\n\n  get name() {\n    return this._fileName;\n  }\n\n  toArrayBuffer() {\n    const flattenedArr: string[] = [];\n    for (const row of this._text) {\n      flattenedArr.push([...row, \"\\n\"].join(\"\"));\n    }\n    const flattenedString = flattenedArr.join(\"\");\n    let buf = new ArrayBuffer(flattenedArr.length); // 2 bytes for each char\n    let bufView = new Uint8Array(buf);\n    for (let i = 0, strLen = flattenedArr.length; i < strLen; i++) {\n      bufView[i] = flattenedString.charCodeAt(i);\n    }\n    return buf;\n  }\n\n  get length() {\n    return this._text.length;\n  }\n\n  get buffer() {\n    return this._buffer;\n  }\n\n  addRowToBuffer(row: TextRow<string>) {\n    this._buffer.push(row.clone());\n  }\n\n  setBuffer(rows: TextRow<string>[]) {\n    this._buffer = rows.map((r) => r.clone());\n  }\n\n  clearBuffer() {\n    this._buffer = [];\n  }\n\n  get textHL() {\n    return this._text_hl;\n  }\n\n  rowAt(y: number): TextRow<string> {\n    return this._text[y];\n  }\n\n  charAt(x: number, y: number) {\n    const row = this._text[y];\n    if (row) {\n      return row.get(x);\n    }\n    return undefined;\n  }\n\n  insertNewRowAt(y: number, row = new TextRow<string>()): void {\n    this._text_hl.splice(y, 0, updateRowSyntaxHighlighting(row));\n    this._text.splice(y, 0, row);\n  }\n\n  insertNewRowsAt(y: number, rows: TextRow<string>[] = []): void {\n    this._text.splice(y, 0, ...rows);\n  }\n\n  replaceRowAt(y: number, withRow: TextRow<string>): void {\n    this._text_hl[y] = updateRowSyntaxHighlighting(withRow);\n    this._text[y] = withRow;\n  }\n\n  removeRowAt(y: number): void {\n    this._text.splice(y, 1);\n  }\n\n  *entries(): Generator<[number, TextRow<string>], void, unknown> {\n    for (const [i, item] of this._text.entries()) {\n      yield [i, item];\n    }\n  }\n}\n","import { TextContent } from \"./text-content\";\n\nexport class Cursor {\n  private cursorX: number = 0;\n  private cursorY: number = 0;\n  private cursorVisible: boolean = true;\n  private textContent: TextContent;\n\n  constructor(textArea: TextContent) {\n    this.textContent = textArea;\n  }\n\n  get X(): number {\n    return this.cursorX;\n  }\n\n  get Y(): number {\n    return this.cursorY;\n  }\n\n  setPosition([x, y]) {\n    this.cursorX = x;\n    this.cursorY = y;\n  }\n\n  get position() {\n    return [this.cursorX, this.cursorY];\n  }\n\n  moveRight(by: number = 1) {\n    if (this.textContent.charAt(this.cursorX, this.cursorY)) {\n      this.cursorX += by;\n    } else if (this.textContent.rowAt(this.cursorY)) {\n      this.setPosition([\n        this.textContent.rowAt(this.cursorY).length,\n        this.cursorY,\n      ]);\n    }\n  }\n\n  moveLeft(by: number = 1) {\n    if (this.cursorX - by >= 0) {\n      this.cursorX -= by;\n    }\n  }\n\n  moveUp(by: number = 1) {\n    if (this.cursorY - by >= 0) {\n      const charAbove = this.textContent.charAt(this.cursorX, this.cursorY - 1);\n      const rowAbove = this.textContent.rowAt(this.cursorY - 1);\n      if (charAbove) {\n        this.cursorY -= by;\n      } else if (rowAbove) {\n        this.setPosition([rowAbove.length, this.cursorY - 1]);\n      }\n    }\n  }\n\n  moveDown(by: number = 1) {\n    const charBelow = this.textContent.charAt(this.cursorX, this.cursorY + 1);\n    const rowBelow = this.textContent.rowAt(this.cursorY + 1);\n    if (charBelow) {\n      this.cursorY += by;\n    } else if (rowBelow) {\n      this.setPosition([rowBelow.length, this.cursorY + 1]);\n    }\n  }\n}\n","import { TextContent } from \"./text-content\";\n\nexport class Scroll {\n  private cursorX: number = 0;\n  private cursorY: number = 0;\n  private _context = undefined;\n  private _canvas = undefined;\n  private _textContent: TextContent;\n  constructor(canvas, context, textContent: TextContent) {\n    this._context = context;\n    this._canvas = canvas;\n    this._textContent = textContent;\n  }\n\n  get X(): number {\n    return this.cursorX;\n  }\n\n  get Y(): number {\n    return this.cursorY;\n  }\n\n  scrollUp(by: number = 200) {\n    if (this.cursorY >= 0) {\n      this.cursorY == 0;\n    } else if (this.cursorY + by > 0) {\n      this._context.translate(0, Math.abs(this.cursorY));\n      this.cursorY += Math.abs(this.cursorY);\n    } else {\n      this.cursorY += by;\n      this._context.translate(0, by);\n    }\n  }\n\n  // Todo: scroll speed leads to different results\n  scrollDown(by: number = 200) {\n    if (\n      Math.abs(this.cursorY) + this._canvas.getBoundingClientRect().height <\n      this._textContent.contentHeight\n    ) {\n      this.cursorY -= by;\n      this._context.translate(0, 0 - by);\n    } else if (\n      Math.abs(this.cursorY) + this._canvas.getBoundingClientRect().height >=\n      this._textContent.contentHeight\n    ) {\n      // Do nothing\n    } else {\n      const remainingHeight =\n        Math.abs(this.cursorY) +\n        this._canvas.getBoundingClientRect().height -\n        this._textContent.contentHeight;\n      this.cursorY -= remainingHeight;\n      this._context.translate(0, 0 - remainingHeight);\n    }\n  }\n}\n","import { scroller, requestRender } from \"../app\";\n\nexport function handleScroll(e: WheelEvent) {\n  const yscroll = e.deltaY;\n  if (yscroll > 0) {\n    scroller.scrollDown(Math.abs(yscroll));\n  } else {\n    scroller.scrollUp(Math.abs(yscroll));\n  }\n  requestRender();\n}\n"],"names":["$6a70f3eb2304cf39$export$cd3d1f114b139967","ratio","window","devicePixelRatio","cv","document","getElementById","div","width","clientWidth","height","clientHeight","rect","getBoundingClientRect","getContext","scale","style","canvas","context","$f99a71eeadf618a9$export$b981489921ee18cd","event","fontContext","x","y","clientX","clientY","$f43313d21d3fd8e2$export$67ea982130081db","Math","round","$f43313d21d3fd8e2$export$f0c6b23f5e8dd3c1","X","left","abs","Y","top","$f99a71eeadf618a9$export$5cc6687e4fba1dbf","$f43313d21d3fd8e2$export$e0e0794250e9118f","charAt","$f43313d21d3fd8e2$export$58734539bbfa41a2","setPosition","rowAt","length","$f43313d21d3fd8e2$export$4e43dc34db4a80af","$03a16a842b07cc30$export$c6fe3936e6366f70","data","gapSize","this","gapStart","gapEnd","buff","Array","concat","g","item","push","delete","ix","moveGap","insert","value","splice","get","slice","ix2","pop","delta","i","_arr","Symbol","iterator","publicIndex","$1c58683fe1a64031$export$63e2a8b9f6372df7","array","_text","clone","charAtIndex","entries","row","insertValueAt","index","deleteValueAt","$e7b21b2df11b04ee$export$582250794ca52d9c","getFileContents","file","text","saveFileContents","name","tc","newHandle","showSaveFilePicker","suggestedName","writableStream","createWritable","write","toArrayBuffer","close","promptFileSelect","fileHandlerList","showOpenFilePicker","multiple","getFile","$7e28cedeb61716a4$export$eeb4adacbff52521","$74a1630e391a5f1d$export$33a13745f5692414","Set","$74a1630e391a5f1d$export$b2089216fe419d98","$74a1630e391a5f1d$export$5b243cfa8f80d63b","$74a1630e391a5f1d$var$isSeparator","s","trim","undefined","$74a1630e391a5f1d$var$isWhitespace","match","$74a1630e391a5f1d$export$303d989387e35475","HLArr","fill","HL_NORMAL","in_string","prev_sep","ch","HL_STRING","isNaN","Number","HL_NUMBER","r","HL_COMMENT","old_prev_sep","kw","klen","cw","join","secondary","has","j","HL_KEYWORD2","HL_KEYWORD1","$04f270dc7db7277e$var$OPEN_BRACKETS","$04f270dc7db7277e$var$BRACKETS_PAIR","$f7e6de5c7da2669a$export$8f45430ccf837300","charXY","cursor","textContent","scroller","save","setTransform","clearRect","restore","fillStyle","fillRect","indexY","indexX","char","textHL","fillText","$13f717a4bbe24257$var$renderText","beginPath","moveTo","lineTo","lineWidth","strokeStyle","stroke","$13f717a4bbe24257$var$renderCursor","$f43313d21d3fd8e2$export$a078c61943f9dbbe","$f43313d21d3fd8e2$export$a5c631d8afd87f93","font","fontSize","linePadding","measureText","fontStyle","setFontStyle","_text_hl","_buffer","_fileName","_fontContext","contentHeight","readFromFile","rows","split","rowOfRows","rowOfRowsHL","rowIn","flattenedArr","flattenedString","buf","ArrayBuffer","bufView","Uint8Array","strLen","charCodeAt","buffer","addRowToBuffer","setBuffer","map","clearBuffer","insertNewRowAt","insertNewRowsAt","replaceRowAt","withRow","removeRowAt","textArea","cursorX","cursorY","cursorVisible","position","moveRight","by","moveLeft","moveUp","charAbove","rowAbove","moveDown","charBelow","rowBelow","_context","_canvas","_textContent","scrollUp","translate","scrollDown","remainingHeight","requestAnimationFrame","$13f717a4bbe24257$export$2e2bcd8739ae039","addEventListener","e","preventDefault","metaKey","shiftKey","includes","code","ctrlKey","then","alert","currentRow","rowToSpit","firstLine","secondLine","orgLen","newRow","key","yscroll","deltaY"],"version":3,"file":"index.cb93a2ef.js.map"}