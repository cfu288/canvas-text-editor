function t(){let t=window.devicePixelRatio,e=document.getElementById("myCanvas"),i=document.getElementById("canvasContainer");e.width=i.clientWidth,e.height=i.clientHeight;let s=i.getBoundingClientRect();return e.width=s.width*t,e.height=s.height*t,e.getContext("2d").scale(t,t),e.style.width=s.width+"px",e.style.height=s.height+"px",{canvas:e,context:e.getContext("2d")}}const e="#282a36",i="#ff79c6",s="#f8f8f2",r="#8be9fd",n="#f1fa8c",o="#8be9fd",a="#6272a4",h="#bd93f9";let c;!function(t){t[t.HL_NORMAL=0]="HL_NORMAL",t[t.HL_NUMBER=1]="HL_NUMBER",t[t.HL_STRING=2]="HL_STRING",t[t.HL_COMMENT=3]="HL_COMMENT",t[t.HL_KEYWORD1=4]="HL_KEYWORD1",t[t.HL_KEYWORD2=5]="HL_KEYWORD2"}(c||(c={}));const l=new Set(["export","import","new"]),u=new Set(l),g=["await","break","case","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","try","var"].concat([...l]);function d(t){return function(t){return 0===t?.trim().length||void 0===t}(t)||"\0"===t||!!t.match("/^[,.()+-/*=~%<>;]/")}function f(t){const e=Array(t.length).fill(c.HL_NORMAL);let i,s=!0,r=0;for(;r<t.length;){const o=t.get(r);void 0!==i?(e.splice(r,1,c.HL_STRING),"\\"===o&&r+1<t.length&&(e.splice(r,1,c.HL_STRING),r++),o===i&&(i=void 0),s=!0):'"'!==o&&"'"!==o||(i=o,e.splice(r,1,c.HL_STRING)),(!isNaN(Number(o))&&(s||e[r-1]===c.HL_NUMBER)||"."==o&&e[r-1]==c.HL_NUMBER)&&e.splice(r,1,c.HL_NUMBER),"/"===(n=t).get(0)&&"/"===n.get(1)&&(e.length=t.length,e.fill(c.HL_COMMENT),r=t.length);const a=s;if(s=d(o),a)for(const i of g){const n=i.length,o=t.text.slice(r,r+n).join("");if(o===i&&t.get(r+n)&&d(t[r+n])){const t=u.has(o);for(let i=0;i<n;i++)t?e.splice(r+i,1,c.HL_KEYWORD2):e.splice(r+i,1,c.HL_KEYWORD1);r+=n,s=!0;break}}r++}var n;return e}function w(t,l){!function(t,o){o.save(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,t.width,t.height),o.restore(),o.fillStyle=e,o.fillRect(0,Math.abs(N.Y),t.width,t.height);for(const[t,e]of H.text.entries()){H.textHL[t]=f(e),o.fillStyle=s;for(const[s,l]of e.entries())o.save(),H.textHL[t][s]===c.HL_NUMBER?o.fillStyle=h:H.textHL[t][s]===c.HL_STRING?o.fillStyle=n:H.textHL[t][s]===c.HL_COMMENT?o.fillStyle=a:H.textHL[t][s]===c.HL_KEYWORD1?o.fillStyle=i:H.textHL[t][s]===c.HL_KEYWORD2&&(o.fillStyle=r),o.fillText(l,E[0]*s,E[1]*(t+1)),o.restore()}}(t,l),function(t,e){e.save(),e.beginPath(),e.moveTo(b.X*E[0]+2,b.Y*E[1]+1),e.lineTo(b.X*E[0]+2,b.Y*E[1]+E[1]+4),e.lineWidth=2,e.strokeStyle=o,e.stroke(),e.restore()}(0,l)}Array.prototype.splice;class p{constructor(t,e=32){this.data=[],this.gapSize=32,this.gapStart=0,this.gapEnd=32;const i=e-t.length>=0?Array(e-t.length):[];this.data=t.concat(i),this.gapSize=e,this.gapEnd=e>t.length?e:t.length,this.gapStart=t.length||0}get length(){return this.data.length-(this.gapEnd-this.gapStart)}concat(t){for(const e of t)this.push(e)}delete(t){this.moveGap(t+1),this.gapStart-=1,this.gapStart<0&&(this.gapStart=0)}insert(t,e){this.gapStart===this.gapEnd?(this.data.splice(t,0,...new Array(this.gapSize)),this.gapStart=t,this.gapEnd=t+this.gapSize):this.moveGap(t),this.data[this.gapStart++]=e}get(t){return t>=this.gapStart?this.data[t+(this.gapEnd-this.gapStart)]:this.data[t]}push(t){this.insert(this.length,t)}pop(){this.moveGap(this.length),this.gapStart-=1,this.gapStart<0&&(this.gapStart=0)}moveGap(t){if(t<this.gapStart){let e=this.gapStart-t;for(let i=e-1;i>=0;i--)this.data[this.gapEnd-e+i]=this.data[t+i];this.gapStart-=e,this.gapEnd-=e}else{let e=t-this.gapStart;for(let t=0;t<e;++t)this.data[this.gapStart+t]=this.data[this.gapEnd+t];this.gapStart+=e,this.gapEnd+=e}}get _arr(){return this.data.slice(0,this.gapStart).concat(this.data.slice(this.gapEnd))}*[Symbol.iterator](){let t=0;for(;t<this.data.length;)t<this.gapStart||t>=this.gapEnd?(yield this.data[t],t+=1):t+=1}*entries(){let t=0,e=0;for(;e<this.data.length;)e<this.gapStart||e>=this.gapEnd?(yield[t,this.data[e]],e+=1,t+=1):e+=1}}class m{constructor(t){this.__text=new p(t||[])}clone(){return new m([...this.__text])}get text(){return[...this.__text]}get(t){return this.__text.get(t)}get gb(){return this.__text}get length(){return this.__text.length}charAtIndex(t){return this.__text.get(t)}entries(){return this.__text.entries()}concat(t){return this.__text.concat(t.gb),this}insertValueAt(t,e){this.__text.insert(t,e)}push(t){this.__text.push(t)}pop(){this.__text.pop()}deleteValueAt(t){this.__text.delete(t)}}let _;!function(t){t.getFileContents=function(t){return t.text()},t.saveFileContents=async function(t,e){const i=await window.showSaveFilePicker({suggestedName:t}),s=await i.createWritable();return await s.write(e.toArrayBuffer()),await s.close()},t.promptFileSelect=async function(){const t=await window.showOpenFilePicker({multiple:!1});return await t[0].getFile()}}(_||(_={}));const A=new Set(["[","{","(",'"',"'"]),Y={"{":"}","[":"]","(":")",'"':'"',"'":"'"};function x(t){const e="Courier New";t.font=`16px ${e}`;return{font:e,fontSize:16,linePadding:4,charXY:[t.measureText(["a"].join("")).width,20]}}const{canvas:S,context:R}=t(),{font:v,fontSize:L,linePadding:y,charXY:E}=x(R),b=new class{constructor(){this.cursorX=0,this.cursorY=0,this.cursorVisible=!0}get X(){return this.cursorX}get Y(){return this.cursorY}setPosition([t,e]){this.cursorX=t,this.cursorY=e}get position(){return[this.cursorX,this.cursorY]}moveRight(t=1){this.cursorX+=t}moveLeft(t=1){this.cursorX-t>=0&&(this.cursorX-=t)}moveUp(t=1){this.cursorY-t>=0&&(this.cursorY-=t)}moveDown(t=1){this.cursorY+=t}},H=new class{constructor(){this._text=[new m],this._text_hl=[[]],this._buffer=[],this._fileName="untitled.txt"}readFromFile(t,e){this._fileName=t||"untitled.txt";const i=e.split("\n"),s=[];for(const t of i)s.push(new m(t.split("")));this._text=s}get name(){return this._fileName}toArrayBuffer(){const t=this._text.reduce(((t,e)=>t.concat([...e.text,"\n"])),[]).join("");var e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(let e=0,s=t.length;e<s;e++)i[e]=t.charCodeAt(e);return e}get length(){return this.text.length}get buffer(){return this._buffer}addRowToBuffer(t){this._buffer.push(t.clone())}setBuffer(t){this._buffer=t.map((t=>t.clone()))}clearBuffer(){this._buffer=[]}get text(){return this._text}get textHL(){return this._text_hl}rowAt(t){return this._text[t]}charAt(t,e){const i=this._text[e];if(i)return i.get(t)}insertNewRowAt(t,e=new m){this._text.splice(t,0,e)}insertNewRowsAt(t,e=[]){this._text.splice(t,0,...e)}replaceRowAt(t,e){this._text[t]=e}removeRowAt(t){this._text.splice(t,1)}},N=new class{constructor(t){this.cursorX=0,this.cursorY=0,this._context=void 0,this._context=t}get X(){return this.cursorX}get Y(){return this.cursorY}scrollUp(t=200){this.cursorY>=0?this.cursorY:this.cursorY+t>0?(this._context.translate(0,Math.abs(this.cursorY)),this.cursorY+=Math.abs(this.cursorY)):(this.cursorY+=t,this._context.translate(0,t))}scrollDown(t=200){this.cursorY-=t,this._context.translate(0,0-t)}}(R);console.log("scroller init"),document.addEventListener("keydown",(function(t){if(t.preventDefault(),t.metaKey&&t.shiftKey&&["ArrowUp","ArrowDown"].includes(t.code))switch(t.code){case"ArrowDown":N.scrollDown(),window.requestAnimationFrame((()=>w(S,R)));break;case"ArrowUp":N.scrollUp(),window.requestAnimationFrame((()=>w(S,R)))}if(t.metaKey||t.ctrlKey)switch(t.code){case"KeyO":_.promptFileSelect().then((t=>_.getFileContents(t).then((e=>{H.readFromFile(t.name,e),window.requestAnimationFrame((()=>w(S,R)))}))));break;case"KeyS":_.saveFileContents(H.name,H).then((()=>{alert(`${H.name} saved`)}));break;case"KeyX":{H.clearBuffer(),H.addRowToBuffer(H.rowAt(b.Y)),H.length>1?H.removeRowAt(b.Y):(H.removeRowAt(b.Y),H.insertNewRowAt(b.Y,new m));const t=H.charAt(b.X,b.Y-1),e=H.rowAt(b.Y-1);t?b.moveUp():e&&b.setPosition([e.length,b.Y-1]);break}case"KeyC":H.clearBuffer(),H.addRowToBuffer(H.rowAt(b.Y));break;case"KeyV":H.insertNewRowsAt(b.Y,H.buffer),b.setPosition([H.rowAt(b.Y).length,b.Y])}else{let e=H.rowAt(b.Y);switch(t.code){case"Escape":case"MetaRight":case"MetaLeft":case"ShiftLeft":case"ShiftRight":break;case"ArrowLeft":b.moveLeft();break;case"ArrowRight":H.charAt(b.X,b.Y)?b.moveRight():H.rowAt(b.Y)&&b.setPosition([H.rowAt(b.Y).length,b.Y]);break;case"ArrowUp":{const t=H.charAt(b.X,b.Y-1),e=H.rowAt(b.Y-1);t?b.moveUp():e&&b.setPosition([e.length,b.Y-1]);break}case"ArrowDown":{const t=H.charAt(b.X,b.Y+1),e=H.rowAt(b.Y+1);t?b.moveDown():e&&b.setPosition([e.length,b.Y+1]);break}case"Enter":if(b.X===H.rowAt(b.Y).length)H.insertNewRowAt(b.Y+1),b.setPosition([0,b.Y+1]);else{const t=H.rowAt(b.Y),e=t.text.slice(0,b.X),i=t.text.slice(b.X,t.length);H.replaceRowAt(b.Y,new m(e)),H.insertNewRowAt(b.Y+1),H.replaceRowAt(b.Y+1,new m(i)),b.setPosition([0,b.Y+1])}break;case"Backspace":if(b.X>0)e.deleteValueAt(b.X-1),b.moveLeft();else if(H.text[b.Y-1]){const t=H.rowAt(b.Y-1).length,e=H.rowAt(b.Y-1).concat(H.text[b.Y]);H.replaceRowAt(b.Y-1,e),H.removeRowAt(b.Y),b.setPosition([t,b.Y-1])}break;case"Tab":e.push(" "),e.push(" "),e.push(" "),e.push(" "),b.moveRight(4);break;default:A.has(t.key)?(e.insertValueAt(b.X,t.key),b.moveRight(),e.insertValueAt(b.X,Y[t.key])):(e.insertValueAt(b.X,t.key),b.moveRight())}}window.requestAnimationFrame((()=>w(S,R)))})),S.addEventListener("mousedown",(function(t){const[e,i]=function(t,e){const i=S.getBoundingClientRect();return[Math.round((N.X+t-i.left)/E[0]),Math.round((Math.abs(N.Y)+e-i.top)/E[1])-1]}(t.clientX,t.clientY);H.charAt(e,i)?b.setPosition([e,i]):H.rowAt(i)&&b.setPosition([H.rowAt(i).length,i]),window.requestAnimationFrame((()=>w(S,R)))})),window.addEventListener("resize",(()=>{t(),x(R),window.requestAnimationFrame((()=>w(S,R)))})),window.requestAnimationFrame((()=>w(S,R))),document.getElementById("openFileButton").addEventListener("click",(()=>{_.promptFileSelect().then((t=>_.getFileContents(t).then((e=>{H.readFromFile(t.name,e),window.requestAnimationFrame((()=>w(S,R)))}))))})),document.getElementById("saveFileButton").addEventListener("click",(()=>{_.saveFileContents(H.name,H).then((()=>{alert(`${H.name} saved`)}))}));
//# sourceMappingURL=index.7c06ae92.js.map
