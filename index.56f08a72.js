function t(){let t=window.devicePixelRatio,e=document.getElementById("myCanvas"),r=document.getElementById("canvasContainer");e.width=r.clientWidth,e.height=r.clientHeight;let n=r.getBoundingClientRect();return e.width=n.width*t,e.height=n.height*t,e.getContext("2d").scale(t,t),e.style.width=n.width+"px",e.style.height=n.height+"px",{canvas:e,context:e.getContext("2d")}}const e="#282a36",r="#ff79c6",n="#f8f8f2",s="#8be9fd",i="#f1fa8c",o="#8be9fd",c="#6272a4",a="#bd93f9";let l;!function(t){t[t.HL_NORMAL=0]="HL_NORMAL",t[t.HL_NUMBER=1]="HL_NUMBER",t[t.HL_STRING=2]="HL_STRING",t[t.HL_COMMENT=3]="HL_COMMENT",t[t.HL_KEYWORD1=4]="HL_KEYWORD1",t[t.HL_KEYWORD2=5]="HL_KEYWORD2"}(l||(l={}));const h=new Set(["export","import","new"]),u=new Set(h),w=["await","break","case","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","try","var"].concat([...h]);function f(t){return function(t){return 0===t.trim().length}(t)||"\0"===t||!!t.match("/^[,.()+-/*=~%<>;]/")}function d(t){const e=Array(t.length).fill(l.HL_NORMAL);let r,n=!0,s=0;for(;s<t.length;){const o=t[s];void 0!==r?(e.splice(s,1,l.HL_STRING),"\\"===o&&s+1<t.length&&(e.splice(s,1,l.HL_STRING),s++),o===r&&(r=void 0),n=!0):'"'!==o&&"'"!==o||(r=o,e.splice(s,1,l.HL_STRING)),(!isNaN(Number(o))&&(n||e[s-1]===l.HL_NUMBER)||"."==o&&e[s-1]==l.HL_NUMBER)&&e.splice(s,1,l.HL_NUMBER),"/"===(i=t)?.[0]&&"/"===i?.[1]&&(e.length=t.length,e.fill(l.HL_COMMENT),s=t.length);const c=n;if(n=f(o),c)for(const r of w){const i=r.length,o=t.slice(s,s+i).join("");if(o===r&&t[s+i]&&f(t[s+i])){const t=u.has(o);for(let r=0;r<i;r++)t?e.splice(s+r,1,l.HL_KEYWORD2):e.splice(s+r,1,l.HL_KEYWORD1);s+=i,n=!0;break}}s++}var i;return e}function g(t,h){!function(t,o){o.save(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,t.width,t.height),o.restore(),o.fillStyle=e,o.fillRect(0,Math.abs(X.Y),t.width,t.height);for(const[t,e]of N.text.entries()){N.textHL[t]=d(e.text),o.fillStyle=n;for(const[n,h]of e.entries())o.save(),N.textHL[t][n]===l.HL_NUMBER?o.fillStyle=a:N.textHL[t][n]===l.HL_STRING?o.fillStyle=i:N.textHL[t][n]===l.HL_COMMENT?o.fillStyle=c:N.textHL[t][n]===l.HL_KEYWORD1?o.fillStyle=r:N.textHL[t][n]===l.HL_KEYWORD2&&(o.fillStyle=s),o.fillText(h,y[0]*n,y[1]*(t+1)),o.restore()}}(t,h),function(t,e){e.save(),e.beginPath(),e.moveTo(H.X*y[0]+2,H.Y*y[1]+1),e.lineTo(H.X*y[0]+2,H.Y*y[1]+y[1]+4),e.lineWidth=2,e.strokeStyle=o,e.stroke(),e.restore()}(0,h)}class Y{constructor(t){this._text=[],this._text=t||[]}clone(){return new Y([...this._text])}get text(){return this._text}get length(){return this._text.length}charAtIndex(t){return this._text[t]}entries(){return this._text.entries()}concat(t){return this._text.concat(t.text),this}concatRaw(t){return this._text.concat(t),this}insertValueAt(t,e){this._text.splice(t,0,e)}push(t){this._text.push(t)}pop(){this._text.pop()}deleteValueAt(t){this._text.splice(t,1)}}let A;!function(t){t.getFileContents=function(t){return t.text()},t.saveFileContents=async function(t,e){const r=await window.showSaveFilePicker({suggestedName:t}),n=await r.createWritable();return await n.write(e.toArrayBuffer()),await n.close()},t.promptFileSelect=async function(){const t=await window.showOpenFilePicker({multiple:!1});return await t[0].getFile()}}(A||(A={}));const _=new Set(["[","{","(",'"',"'"]),x={"{":"}","[":"]","(":")",'"':'"',"'":"'"};function m(t){const e="Courier New";t.font=`16px ${e}`;return{font:e,fontSize:16,linePadding:4,charXY:[t.measureText(["a"].join("")).width,20]}}const{canvas:p,context:R}=t(),{font:L,fontSize:v,linePadding:b,charXY:y}=m(R),H=new class{constructor(){this.cursorX=0,this.cursorY=0,this.cursorVisible=!0}get X(){return this.cursorX}get Y(){return this.cursorY}setPosition([t,e]){this.cursorX=t,this.cursorY=e}get position(){return[this.cursorX,this.cursorY]}moveRight(t=1){this.cursorX+=t}moveLeft(t=1){this.cursorX-t>=0&&(this.cursorX-=t)}moveUp(t=1){this.cursorY-t>=0&&(this.cursorY-=t)}moveDown(t=1){this.cursorY+=t}},N=new class{constructor(){this._text=[new Y],this._text_hl=[[]],this._buffer=[],this._fileName="untitled.txt"}readFromFile(t,e){this._fileName=t||"untitled.txt";const r=e.split("\n"),n=[];for(const t of r)n.push(new Y(t.split("")));this._text=n}get name(){return this._fileName}toArrayBuffer(){const t=this._text.reduce(((t,e)=>t.concat([...e.text,"\n"])),[]).join("");var e=new ArrayBuffer(2*t.length),r=new Uint8Array(e);for(let e=0,n=t.length;e<n;e++)r[e]=t.charCodeAt(e);return e}get length(){return this.text.length}get buffer(){return this._buffer}addRowToBuffer(t){this._buffer.push(t.clone())}setBuffer(t){this._buffer=t.map((t=>t.clone()))}clearBuffer(){this._buffer=[]}get text(){return this._text}get textHL(){return this._text_hl}rowAt(t){return this._text[t]}charAt(t,e){const r=this._text[e];if(r)return r.text[t]}insertNewRowAt(t,e=new Y){this._text.splice(t,0,e)}insertNewRowsAt(t,e=[]){this._text.splice(t,0,...e)}replaceRowAt(t,e){this._text[t]=e}removeRowAt(t){this._text.splice(t,1)}},X=new class{constructor(t){this.cursorX=0,this.cursorY=0,this._context=void 0,this._context=t}get X(){return this.cursorX}get Y(){return this.cursorY}scrollUp(t=200){this.cursorY>=0?this.cursorY:this.cursorY+t>0?(this._context.translate(0,Math.abs(this.cursorY)),this.cursorY+=Math.abs(this.cursorY)):(this.cursorY+=t,this._context.translate(0,t))}scrollDown(t=200){this.cursorY-=t,this._context.translate(0,0-t)}}(R);console.log("scroller init"),document.addEventListener("keydown",(function(t){if(t.preventDefault(),t.metaKey&&t.shiftKey&&["ArrowUp","ArrowDown"].includes(t.code))switch(t.code){case"ArrowDown":X.scrollDown(),window.requestAnimationFrame((()=>g(p,R)));break;case"ArrowUp":X.scrollUp(),window.requestAnimationFrame((()=>g(p,R)))}if(t.metaKey||t.ctrlKey)switch(t.code){case"KeyO":A.promptFileSelect().then((t=>A.getFileContents(t).then((e=>{N.readFromFile(t.name,e),window.requestAnimationFrame((()=>g(p,R)))}))));break;case"KeyS":A.saveFileContents(N.name,N).then((()=>{alert(`${N.name} saved`)}));break;case"KeyX":{N.clearBuffer(),N.addRowToBuffer(N.rowAt(H.Y)),N.length>1?N.removeRowAt(H.Y):(N.removeRowAt(H.Y),N.insertNewRowAt(H.Y,new Y));const t=N.charAt(H.X,H.Y-1),e=N.rowAt(H.Y-1);t?H.moveUp():e&&H.setPosition([e.length,H.Y-1]);break}case"KeyC":N.clearBuffer(),N.addRowToBuffer(N.rowAt(H.Y));break;case"KeyV":N.insertNewRowsAt(H.Y,N.buffer),H.setPosition([N.rowAt(H.Y).length,H.Y])}else{let e=N.rowAt(H.Y);switch(t.code){case"Escape":case"MetaRight":case"MetaLeft":case"ShiftLeft":case"ShiftRight":break;case"ArrowLeft":H.moveLeft();break;case"ArrowRight":N.charAt(H.X,H.Y)?H.moveRight():N.rowAt(H.Y)&&H.setPosition([N.rowAt(H.Y).length,H.Y]);break;case"ArrowUp":{const t=N.charAt(H.X,H.Y-1),e=N.rowAt(H.Y-1);t?H.moveUp():e&&H.setPosition([e.length,H.Y-1]);break}case"ArrowDown":{const t=N.charAt(H.X,H.Y+1),e=N.rowAt(H.Y+1);t?H.moveDown():e&&H.setPosition([e.length,H.Y+1]);break}case"Enter":if(H.X===N.rowAt(H.Y).length)N.insertNewRowAt(H.Y+1),H.setPosition([0,H.Y+1]);else{const t=N.rowAt(H.Y),e=t.text.slice(0,H.X),r=t.text.slice(H.X,t.length);N.replaceRowAt(H.Y,new Y(e)),N.insertNewRowAt(H.Y+1),N.replaceRowAt(H.Y+1,new Y(r)),H.setPosition([0,H.Y+1])}break;case"Backspace":if(H.X>0)e.deleteValueAt(H.X-1),H.moveLeft();else if(N.text[H.Y-1]){const t=N.rowAt(H.Y-1).length,e=N.rowAt(H.Y-1).concat(N.text[H.Y]);N.replaceRowAt(H.Y-1,e),N.removeRowAt(H.Y),H.setPosition([t,H.Y-1])}break;case"Tab":e.push(" "),e.push(" "),e.push(" "),e.push(" "),H.moveRight(4);break;default:_.has(t.key)?(e.insertValueAt(H.X,t.key),H.moveRight(),e.insertValueAt(H.X,x[t.key])):(e.insertValueAt(H.X,t.key),H.moveRight())}}window.requestAnimationFrame((()=>g(p,R)))})),p.addEventListener("mousedown",(function(t){const[e,r]=function(t,e){const r=p.getBoundingClientRect();return[Math.round((X.X+t-r.left)/y[0]),Math.round((Math.abs(X.Y)+e-r.top)/y[1])-1]}(t.clientX,t.clientY);N.charAt(e,r)?H.setPosition([e,r]):N.rowAt(r)&&H.setPosition([N.rowAt(r).length,r]),window.requestAnimationFrame((()=>g(p,R)))})),window.addEventListener("resize",(()=>{t(),m(R),window.requestAnimationFrame((()=>g(p,R)))})),window.requestAnimationFrame((()=>g(p,R)));
//# sourceMappingURL=index.56f08a72.js.map
